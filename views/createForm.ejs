
<!DOCTYPE html>
<html>
<head>
  <title>Create Form</title>
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <h2>Create a Form</h2>
  <form id="formCreate">
    <input name="formName" placeholder="Form Name" required />
    <div id="fields"></div>
    <button type="button" onclick="addField()">Add Field</button>
    <button type="submit">Create Form</button>
  </form>
  <div id="result"></div>

  <script>
    let fieldCount = 0;
    function addField() {
      const container = document.getElementById('fields');
      const fieldHTML = \`
        <div>
          <input name="fields[\${fieldCount}][name]" placeholder="Field Name" required />
          <select name="fields[\${fieldCount}][type]" onchange="toggleOptions(this, \${fieldCount})">
            <option value="text">Text</option>
            <option value="number">Number</option>
            <option value="dropdown">Dropdown</option>
          </select>
          <input name="fields[\${fieldCount}][options]" placeholder="Options (comma separated)" style="display:none" />
        </div>\`;
      container.insertAdjacentHTML('beforeend', fieldHTML);
      fieldCount++;
    }

    function toggleOptions(select, index) {
      const input = select.parentElement.querySelector(\`input[name="fields[\${index}][options]"]\`);
      input.style.display = (select.value === "dropdown") ? "inline" : "none";
    }

    document.getElementById("formCreate").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = new FormData(e.target);
      const fields = [];
      for (let [key, value] of form.entries()) {
        if (key.startsWith("fields[")) {
          const [, index, prop] = key.match(/fields\[(\d+)\]\[(\w+)\]/);
          fields[index] = fields[index] || {};
          fields[index][prop] = value;
        }
      }
      const response = await fetch("/admin/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ formName: form.get("formName"), fields })
      });
      const data = await response.json();
      document.getElementById("result").innerHTML = \`<a href="\${data.link}">Open Form</a>\`;
    });
  </script>
</body>
</html>
